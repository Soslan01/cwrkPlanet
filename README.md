# cwrkPlanet

–ê–Ω–∞–ª–æ–≥ —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –≤ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç–∞—Ö.

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω docker –∏ postgreSQL. –í –∫–æ—Ä–Ω–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤—Å–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π `make run`. –ó–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –≤—Å–µ –∫–æ–º–∞–Ω–¥–∞–º–∏ `make stop` –∏ `make down`(–¥–ª—è docker)

## ‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**Api-gateway** ‚Äî —Å–µ—Ä–≤–∏—Å-–ø—Ä–æ–∫—Å–∏, –Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏–π –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ (frontend) –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Å–µ—Ä–≤–∏—Å–∞–º —á–µ—Ä–µ–∑ gRPC.

**–ü—Ä–∏–º–µ—Ä —Ü–µ–ø–æ—á–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:**
`client (HTTP)` ‚Üí `api-gateway (gRPC)` ‚Üí `auth-service`
–û—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ —Ç–µ–º –∂–µ –ø—É—Ç—ë–º.

---

## üîê Auth-service

–°–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º **RS256** –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–æ–≤.
–î–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö, —Å–µ—Å—Å–∏—è—Ö –∏ –ø–∞—Ä–æ–ª—è—Ö —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **PostgreSQL**, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å —Å–µ—Ä–≤–∏—Å–æ–º.
–≠—Ç–∞ –∂–µ –±–∞–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ –≤ `room-service`.

### **Handlers**

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

**POST** `localhost:8080/auth/register`

```json
{
  "email": "leorik5@mail.com",
  "displayName": "leorik5",
  "password": "leo100398"
}
```

#### –õ–æ–≥–∏–Ω

**POST** `localhost:8080/auth/login`

```json
{
  "email": "leorik5@mail.com",
  "password": "sos100398"
}
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

**POST** `localhost:8080/auth/refresh`

```json
{
  "refreshToken": "5k299SV304UUx9xWQWjOdnzqeMNRF0fAgOCA19bZUNw"
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

**GET** `localhost:8080/auth/me`
**Headers:**

```
Authorization: Bearer <access_token>
```

---

## üè† Room-service

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∫–æ–º–Ω–∞—Ç –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.
–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Ç–∞–∫–∏–º –∂–µ –æ–±—Ä–∞–∑–æ–º (–∫–∞–∫ —Å auth-service) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ `api-gateway`.

**–ü—Ä–∏–º–µ—Ä:**
`client (HTTP)` ‚Üí `api-gateway (gRPC)` ‚Üí `room-service`

–í **PostgreSQL** —Ö—Ä–∞–Ω—è—Ç—Å—è:

* –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–º–Ω–∞—Ç–∞—Ö;
* —É—á–∞—Å—Ç–Ω–∏–∫–∞—Ö;
* –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (–≤ –±—É–¥—É—â–µ–º –±—É–¥–µ—Ç —Ç–∞–∫–∂–µ –≤—ã–≥—Ä—É–∂–∞—Ç—å—Å—è –≤ Redis –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞).

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è **WebSocket** –¥–ª—è –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤ –∫–æ–º–Ω–∞—Ç–∞—Ö.
–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è **WebRTC** –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–∞–Ω–∞–ª–æ–≤. (–õ–∏–±–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å)

---

### **Handlers**

#### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã

**POST** `localhost:8080/rooms`
**Headers:**

```
Authorization: Bearer <access_token>
X-User-ID: 11
Content-Type: application/json
```

```json
{
  "name": "Test room3",
  "max": 5
}
```

#### –°–ø–∏—Å–æ–∫ –∫–æ–º–Ω–∞—Ç

**GET** `localhost:8080/rooms?limit=10`

#### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–Ω–∞—Ç–µ

**GET** `localhost:8080/rooms/{id}`

#### –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ

**POST** `localhost:8080/rooms/{id}/join`

#### –í—ã—Ö–æ–¥ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã

**POST** `localhost:8080/rooms/{id}/leave`

#### –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

**GET** `localhost:8080/rooms/{id}/participants`

#### –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

**GET** `localhost:8080/rooms/{id}/chat?after=&limit=20`

---

## üîÅ WebSocket (—á–∞—Ç)

**Endpoint:**
`ws://localhost:8082/ws/rooms/{id}?access_token=<access_token>&user_id=<id>`

**–ü—Ä–∏–º–µ—Ä –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:**

```json
{
  "type": "chat",
  "payload": {
    "message": "–í—Å–µ–º –ø—Ä–∏–≤–µ—Ç!"
  }
}
```

**–ü—Ä–∏–º–µ—Ä —Å–æ–±—ã—Ç–∏—è (peer):**

```json
{
  "type": "chat",
  "payload": {
    "room_id": "room_123",
    "user_id": "1",
    "message": "–í—Å–µ–º –ø—Ä–∏–≤–µ—Ç!",
    "msg_id": "msg_20251110_1",
    "ts_unix": 1731253425
  }
}
```

---

–ü—Ä–æ–µ–∫—Ç –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è. –í –±–ª–∏–∂–∞–π—à–∏—Ö –ø–ª–∞–Ω–∞—Ö:

* –≤–∞–ª–∏–¥–∞—Ü–∏—è JWT –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á;
* –ø–µ—Ä–µ–Ω–æ—Å –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Redis;
* –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ WebRTC –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–æ–º–Ω–∞—Ç.
